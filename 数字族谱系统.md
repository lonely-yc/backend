# 一、项目名称

**数字家族族谱可视化系统**（Digital Family Genealogy System）

---

# 二、项目背景与目标

## 2.1 项目背景

在中国传统文化中，族谱用于记录家族血脉传承、人物关系和重要事迹。但传统纸质族谱存在以下问题：

- 不易保存，易损坏
- 更新成本高，难以协作维护
- 只能线性查看，关系不直观
- 人物信息无法动态扩展

随着前端可视化技术和 Web 应用的发展，有条件将族谱进行**数字化、结构化、可视化**，形成可长期演化的家族数据系统。

---

## 2.2 项目目标

本项目旨在构建一个：

> **可视化 · 可维护 · 可扩展 · 可传承** 的数字族谱系统

核心目标包括：

- 通过图形化方式直观展示家族多代关系
- 支持复杂亲缘结构（父子、母子、配偶、过继等）
- 为每位成员记录完整的人物信息与生平事件
- 支持后代持续新增与历史数据修正
- 为普通用户提供清晰易用的族谱浏览体验

---

# 三、系统整体架构设计

## 3.1 总体架构

系统采用典型的前后端分离架构：

```
┌────────────┐        ┌──────────────┐        ┌──────────────┐
│   前端 UI  │  HTTP  │   后端服务   │  JDBC  │   数据库     │
│ Vue + G6  │ ─────▶ │ Spring Boot  │ ─────▶ │   MySQL      │
└────────────┘        └──────────────┘        └──────────────┘
```

---

## 3.2 前端架构（Vue + G6）

### 前端职责

- 页面展示与用户交互
- 族谱关系图的可视化渲染
- 人物信息的查看、编辑、标记
- 图谱缩放、拖拽、定位

### 核心技术

- **Vue 3**：组件化开发，负责业务状态管理
- **G6（AntV）**：关系图可视化引擎，用于绘制族谱图
- **Element Plus / Naive UI**：基础 UI 组件库

### 模块划分

```
frontend/
 ├─ views/
 │   ├─ FamilyTree.vue      // 族谱主页面
 │   └─ PersonDetail.vue   // 人物详情弹窗
 ├─ graph/
 │   ├─ initGraph.js       // G6 初始化
 │   ├─ nodePerson.js      // 人物节点定义
 │   └─ edgeRelation.js   // 亲缘关系连线
 ├─ api/
 │   └─ family.js          // 后端接口封装
```

---

## 3.3 后端架构（Spring Boot）

### 后端职责

- 家族数据管理与存储
- 族谱结构计算与封装
- 数据校验与权限控制
- 操作日志与历史记录

### 核心技术

- **Spring Boot**：REST API 服务
- **MyBatis Plus**：ORM 数据访问
- **MySQL**：族谱数据持久化存储

### 后端模块

```
backend/
 ├─ controller/     // 接口层
 ├─ service/        // 业务逻辑
 ├─ mapper/         // 数据访问
 ├─ entity/         // 数据实体
 └─ dto/            // 前端传输对象
```

---

# 四、核心业务模型设计

## 4.1 人物模型（Person）

用于表示族谱中的每一位成员。

主要信息包括：

- 姓名
- 性别
- 世代编号（generation）
- 生卒信息
- 是否重点人物（标星）
- 人物简介

人物是整个系统的**核心节点**。

---

## 4.2 亲缘关系模型（Relation）

用于描述人物之间的关系，而不是简单的父子树结构。

支持的关系类型包括：

- 父子 / 母子
- 配偶
- 养子 / 过继

通过关系模型可以支持复杂、真实的家族结构。

---

## 4.3 人物事件模型（Event）

用于记录人物一生中的重要经历：

- 出生、去世
- 迁徙
- 功名、仕途
- 家族重大事件

事件以时间轴形式展示，增强族谱的人文价值。

---

# 五、族谱可视化设计思路

## 5.1 可视化模型

- 每个人：一个图节点（Node）
- 每段关系：一条连线（Edge）
- 每一代：横向分组布局

采用 **横向世代布局**：

```
第一代  ── 第二代  ── 第三代  ── 第四代
```

---

## 5.2 交互设计

- 鼠标拖拽：平移族谱
- 滚轮缩放：查看大规模家族
- 点击人物：查看详细信息
- 高亮显示：祖先链 / 后代链

---

# 六、典型使用流程

1. 管理员创建家族根节点（始祖）
2. 逐代添加后代成员
3. 录入人物基本信息与生平事件
4. 前端实时生成族谱关系图
5. 用户通过图谱浏览家族历史

---

# 七、项目阶段规划（建议）

## 阶段一：基础族谱展示（MVP）

- 人物录入
- 父子关系
- 横向族谱图展示
- 缩放、拖拽

## 阶段二：信息增强

- 人物详情页
- 标星人物
- 生平事件

## 阶段三：高级能力

- [x] 权限控制
- [x] 操作日志
- [x] 多分支协作维护
- [x] **时间轴联动族谱** ✅ 已完成

### 时间轴联动功能（2024年2月完成）

#### 实现内容

| 模块 | 文件 | 改动说明 |
|------|------|----------|
| GraphManager | `js/graph.js` | 新增 `focusNode`、`highlightPath`、`clearHighlight` 方法 |
| 状态管理 | `js/app.js` | 新增 `linkedPersonId`、`linkedEventId`、`linkageMode` 状态 |
| 联动逻辑 | `js/app.js` | 新增 `onTimelineEventClick`、`onGraphNodeClick`、`scrollTimelineToPerson` 方法 |
| 界面交互 | `index.html` | 时间轴点击事件、联动开关、个人时间轴区块 |
| 样式 | `css/style.css` | 高亮状态、个人时间轴样式 |

#### 核心交互

1. **时间轴 → 图谱**：点击时间轴事件，自动跳转到族谱图并高亮该人物及其祖先/后代链
2. **图谱 → 时间轴**：开启联动模式后，点击人物自动跳转到时间轴并滚动到对应事件
3. **个人时间轴**：人物详情抽屉底部新增个人生平时间轴预览

#### 技术细节

- `highlightPath()` 方法会递归查找祖先和后代节点
- 高亮状态分类：
  - **目标人物**：紫色边框（#4f46e5）
  - **祖先链**：橙色边框（#f59e0b）
  - **后代链**：蓝色边框（#3b82f6）
- 时间轴高亮时卡片带阴影和淡紫色背景

---

# 九、当前项目进度

## 已完成功能

### 核心功能
- [x] 用户登录/注册
- [x] 家族管理（创建、编辑、删除）
- [x] 成员管理（增删改查）
- [x] 关系管理（父子、配偶）
- [x] 族谱可视化（G6 TreeGraph）
- [x] 人物详情抽屉
- [x] 生平事件管理
- [x] 时间轴视图
- [x] 数据统计
- [x] 操作日志
- [x] 数据导入导出

### 特色功能
- [x] 标星重点人物
- [x] 世代筛选
- [x] 性别筛选
- [x] 关键词搜索
- [x] 图谱美化布局
- [x] **时间轴与图谱双向联动**

## 项目结构

```
E:\HTML\demo3\
├── index.html              # 主页面（Vue 3）
├── js/
│   ├── app.js            # Vue 应用主逻辑
│   ├── graph.js          # G6 图谱管理
│   └── store.js          # API 数据层
├── css/
│   └── style.css         # 样式文件
└── 数字族谱系统.md        # 项目文档
```

## 技术栈

| 层级 | 技术 |
|------|------|
| 前端框架 | Vue 3 |
| 可视化 | AntV G6 4.x |
| UI 组件 | Material Design Icons |
| 样式 | 原生 CSS（Light Minimal Theme） |
| 后端（分离） | Spring Boot + MySQL |

---

# 十、待开发功能

- [x] 批量导入成员数据
- [ ] 图片/文档附件上传
- [ ] 族谱对比视图
- [ ] 导出为 PDF/图片
- [ ] 族谱协作编辑权限细分
- [ ] 搜索结果地图可视化

### 批量导入功能（2024年新增）

#### 实现内容

| 模块 | 文件 | 改动说明 |
|------|------|----------|
| 依赖 | `index.html` | 引入 SheetJS (xlsx) 库 |
| UI | `index.html` | 添加"批量导入成员"和"下载模板"菜单项 |
| 逻辑 | `js/app.js` | 新增 `downloadTemplate()` 和 `importExcel()` 函数 |

#### 功能说明

1. **下载模板**：点击后下载Excel模板文件，包含示例数据
2. **批量导入**：支持导入 `.xlsx` 或 `.xls` 格式的Excel文件
3. **自动建立关系**：根据"父亲姓名"、"母亲姓名"、"配偶姓名"列自动建立亲缘关系
4. **字段支持**：
   - 姓名、性别、世代
   - 出生日期、去世日期
   - 出生地/籍贯、简介
   - 父亲姓名、母亲姓名、配偶姓名

---

# 更新日志

## 2025年 - 功能更新与Bug修复

### 批量导入成员功能
- 新增Excel批量导入成员功能
- 支持下载导入模板
- 支持自动建立父子、配偶关系

### 后端Bug修复
| 日期 | 文件 | 问题 | 修复 |
|------|------|------|------|
| 2024-02 | `PdfExportService.java` | 方法名拼写错误 `build Toc` | 改为 `buildToc` |
| 2024-02 | `PdfExportService.java` | 类型不匹配 `allRows.add(row)` | 包装成 `rowWrapper` 后添加 |
| 2024-02 | `PdfExportService.java` | lambda引用的局部变量不是final | 添加 `final` 修饰符 |

---

# 八、项目价值总结

本项目不仅是一个技术实践项目，更是：

- 家族文化的数字化载体
- 可长期维护的数据系统
- 前后端综合能力的完整体现

适用于：

- 个人技术作品
- 家族档案系统
- 文化数字化方向项目
